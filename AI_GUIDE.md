# PowerShell Controller 開発ガイド

## プロジェクト概要
このプロジェクトは、Pythonから簡単にPowerShellを操作するためのライブラリ「py-pshell」を開発しています。同期・非同期APIを提供し、Windows/Linux/macOSで動作する、クロスプラットフォームなPowerShellコントローラーです。

## 開発ガイドライン

### 優先ライブラリ
以下のライブラリを必ず使用してください：
- loguru：ログ管理（標準loggingの代わり）
- pydantic：データ検証（dataclassesやattrsの代わり）
- tenacity：リトライ処理（独自実装の代わり）
- pytest/pytest-asyncio/pytest-timeout/pytest-mock：テスト（unittestの代わり）
- result：戻り値を用いたエラー処理（例外のみの処理の代わり）

### 設定管理
- pyproject.tomlに設定を集約する
- setup.py、requirements.txt、pytest.iniは作成しない

### 開発環境
- Windows 11でPowerShell 7を使用
- PowerShellではWindows形式のパス（`cd C:\Users\root\...`）を使用
- 不要ファイルは即時削除（移動後の古いファイル等）

### 開発プロセス（TDD）
1. インターフェース（interfaces.py）を決定
2. テストコード作成
3. 実装
4. テスト実行、エラーが無くなるまで修正継続

### インターフェース管理
- インターフェースは無断変更禁止（変更必要時はユーザに相談）
- ユーザ許可後の変更はテストコード→実装の順で実施
- テストエラー時はテストコードに問題がある可能性も考慮
- インターフェース変更不要のテスト問題は、ユーザ許可なしでテスト→実装の順で修正可

### エラー修正プロセス
1. エラーメッセージ分析で根本原因特定
2. 最適解決策実装
3. 即時動作確認
4. 新エラー発生時は1に戻る
5. 成功時は簡潔に修正内容報告

### コード品質向上
- 各関数にdocstring（目的、引数、戻り値）を記載
- 明確な変数名・関数名を使用
- loguruによる適切なログレベル出力
- 具体的なエラー処理（ファイル名・行番号・エラー種類・原因）
- pydanticによるデータ検証

### コード複雑性軽減
- ファイル分割：機能単位（1ファイル300行以内）
- 単一責務：各クラス・関数は1つの責務
- 非同期処理：コンポジション優先、パターン統一
- エラー処理集約：捕捉と処理の集中、種類単純化
- テスト容易性：依存性注入、モック可能インターフェース
- デザインパターン：コマンド・ファサードパターン活用
- コード重複排除：機能の一元化と再利用

### テスト構造
- tests/unit: 単体テスト
- tests/integration: 統合テスト

## 実装時の注意点
- コントローラーとセッションは明確に責務を分離する
- 非同期処理は一貫性を持って実装する
- エラー処理は集約して、使いやすいAPIを提供する
- 設定はpydanticを用いて検証する
- ログはloguruを使用して適切なレベルで出力する

## README編集方針
- README.mdは編集しない（ユーザからの明示的指示がある場合のみ例外）
- 実装詳細やインターフェース仕様は各実装ファイル内のdocstringやコメントに記載 